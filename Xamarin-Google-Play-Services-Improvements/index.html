
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Improvements coming to Xamarin Google Play Services - Redth</title>
  <meta name="author" content="Jon">

  
  <meta name="description" content="We're continuing to make Google Play Services a better experience for all Xamarin Developers!">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://redth.info/Xamarin-Google-Play-Services-Improvements">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Redth" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-6465612-17']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Redth</a></h1>
  
    <h2>code, ramblings, rants</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:redth.info" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Improvements Coming to Xamarin Google Play Services</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-05-22T00:00:00-04:00" pubdate data-updated="true">May 22<span>nd</span>, 2015</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Google Play Services is a rapidly evolving library that Google has been using to combat fragmentation on the platform, and ensure their developers have access to great new API&#8217;s without having to worry about what Android version their users are actually on.</p>

<p>The rate at which this library has evolved recently has been especially challenging for us to keep pace with in getting bindings out for Xamarin.Android, but, rest assured, we are committed to bringing out a great Google Play Services experience in your Xamarin apps.  Here are some of the improvements we&#8217;ve been making that are now available as pre-release!</p>

<h2>Latest and Greatest</h2>

<p>Google has rapidly iterated in the last few revisions.  We went from 6.5 to 7.0 to 7.3 very quickly, and we&#8217;re happy to say we&#8217;re shipping the latest and greatest and expect to keep a better track record going forward on getting the latest out quickly!</p>

<p><strong>NOTE:</strong> As of this post, the improvements are available on NuGet as <strong><em>24.0.0-rc1</em></strong> versioned pacakges.</p>

<h2>NuGet what you Want</h2>

<p>We&#8217;ve now split up Google Play Services into many NuGet packages to match the changes Google made to split them up into many .jar files.  Using NuGet we&#8217;re able to manage the dependencies between all of the packages.  For example, all packages depend on the <em>Google Play Services - Base</em> package, while others such as <em>Location</em> depend on <em>Maps</em> as well.</p>

<p>You can now grab only the packages you need in your app without bringing in everything else.  This should help keep your app size down as Google continues to expand Play Services adding more and more features and API&#8217;s.</p>

<p>Finally, the old <em>Google Play Services - All</em> package has been kept around to help make the transition easier.  It now depends on all of the individual NuGet packages.</p>

<h2>Breaking Changes, Nicer Naming</h2>

<p>In the process of binding libraries to make them more C# friendly, we often run into cases where casing is different between java and C#.  For example, in java, we have <code>cast.Cast</code> which in C# translates into <code>Cast.Cast</code>.  Since we cannot have a class named the same as its namespace in C#, this presents a problem.  Traditionally we have renamed the class, for example to <code>Cast.CastClass</code>.  This isn&#8217;t always very discoverable or nice to look at.</p>

<p>We&#8217;ve now decided to change the namespaces instead of renaming the conflicting classes.  All namespaces now have <em>Sdk</em> appended to them, so we now have <code>CastSdk.Cast</code> for instance.  This should be much more consistent and discoverable going foward.</p>

<p>The other area where this is a problem is with fields in java.  For instance, <code>Fitness.FITNESS_API</code> and <code>Fitness.FitnessApi</code> in java both transform into <code>Fitness.FitnessApi</code> in a C# binding by default.  To avoid conflicts and bring consistency across the bindings, we&#8217;ve decided to keep the java naming conventions in the C# binding.</p>

<p>You&#8217;ll now use the upper-cased <code>Fitness.FITNESS_API</code> fields to specify an Api to add in your <code>IGoogleApiClient.AddApi (..)</code> calls, whereas you&#8217;ll use the lower-cased <code>Fitness.FitnessApi</code> fields to actually invoke methods of the given Api.</p>

<h2>Happier C# Developers</h2>

<p>Our binding tooling generally does a good job at making java libraries more C#-ified.  Google Play Services has a number of cases that are less friendly to our tooling and often this has created a sub-par developer experience from a C# perspective.</p>

<p>We&#8217;re continuing to work at improving this story in Google Play Services, and there are a couple of changes that should make life better:</p>

<h3>IPendingResult.AsAsync</h3>

<p>A very common pattern in Google Play Services is to make use of the interface <code>IPendingResult</code>.  This is sort of like a <code>Task</code> - it&#8217;s a promise or a future.  You can <code>.Await()</code> it in a blocking manner (though you must do so off the UI thread), or you can <code>.SetResultCallback (IResultCallback)</code> which means you need to pass in an implementation of the interface which usually means creating an implementor class with some Actions or Events to make the code a bit less ugly (since we don&#8217;t have anonymous classes in C#).</p>

<p>You now have more options with <code>IPendingIntent</code> instances through some extension methods:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="c1">// 1. Turn it into a Task with the desired result type</span>
</span><span class='line'><span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">SomeMethodReturningPendingIntent</span> <span class="p">(...)</span>
</span><span class='line'>  <span class="p">.</span><span class="n">AsAsync</span><span class="p">&lt;</span><span class="n">TypeOfStatus</span><span class="p">&gt;</span> <span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 2. Pass in an Action&lt;T&gt; to the callback</span>
</span><span class='line'><span class="n">SomeMethodReturningPendingIntent</span> <span class="p">(...)</span>
</span><span class='line'>  <span class="p">.</span><span class="n">SetResultCallback</span><span class="p">&lt;</span><span class="n">TypeOfStatus</span><span class="p">&gt;</span> <span class="p">(</span><span class="n">result</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// ...</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Helper Implementor Classes</h3>

<p>There&#8217;s still a lot of areas that require you pass in some sort of class implementing a listener type of interface.  <code>ILocationListener</code> is a good example.  Instead of having to build your own class which implements this simple interface, we&#8217;ve added a class <code>LocationListener</code> which implements <code>ILocationListener</code> and exposes an event for you.  Nothing earth-shattering here, but hopefully it saves you from writing the same boiler plate code over and over.</p>

<p>You can expect more implementation classes like this going forward.</p>

<h3>GoogleApiClientBuilder</h3>

<p>The first place you&#8217;ll probably notice the heavy use of interfaces is in the <code>GoogleApiClientBuilder</code>.  The <code>.AddConnectionCallbacks (..)</code> and <code>.AddOnConnectionFailedListener (..)</code> methods both require instances of interface implementations as parameters.  You can still call these methods like normal, but now there&#8217;s extension methods allowing you to pass Action&#8217;s into them as appropriate.  Again, this is code you could easily write, but shouldn&#8217;t have to.</p>

<h3>Less p0, p1, p2</h3>

<p>This has always been a bit of an eye-sore, to see poorly named parameters.  We&#8217;ve made some improvements in our tooling that are going to continue to help get better parameter names.  We&#8217;ve started trying some of these techniques out already in Google Play Services!</p>

<h2>Feedback?</h2>

<p>I don&#8217;t always get to explore all of the API&#8217;s inside Google Play Services on a day to day basis, so I&#8217;m not always aware of where the pain points are.</p>

<p>I&#8217;m very open to feedback if there&#8217;s other areas you&#8217;d like to see some C# improvements to like we&#8217;ve started.</p>

<p>Please don&#8217;t be shy, mention me on twitter with any suggestions you have!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jon</span></span>

      








  


<time datetime="2015-05-22T00:00:00-04:00" pubdate data-updated="true">May 22<span>nd</span>, 2015</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://redth.info/Xamarin-Google-Play-Services-Improvements" data-via="redth" data-counturl="http://redth.info/Xamarin-Google-Play-Services-Improvements" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/Xamarin-Studio-Launcher-v3" title="Previous Post: New and Improved Xamarin Studio Launcher">&laquo; New and Improved Xamarin Studio Launcher</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  	<br />
  	<p><img src="/images/Site/Redth.png" alt="Redth" /></p>
  
  	<p>
   	 <a href="http://www.amazon.com/gp/product/1118026438/ref=as_li_tf_il?ie=UTF8&camp=1789&creative=9325&creativeASIN=1118026438&linkCode=as2&tag=red082-20"><img border="0" src="http://ws-na.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=1118026438&Format=_SL160_&ID=AsinImage&MarketPlace=US&ServiceVersion=20070822&WS=1&tag=red082-20" ></a><img src="http://ir-na.amazon-adsystem.com/e/ir?t=red082-20&l=as2&o=1&a=1118026438" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />

     </p>

     <p><a href="http://gonemobile.io" target="_blank"><img src="/images/Site/Gone-Mobile-Podcast.png" alt="Gone Mobile Podcast" title="Gone Mobile Podcast" /></a></p>

     <p><a href="http://planet.xamarin.com" target="_blank"><img src="/images/Site/Xamarin-Planet-Badge.png" alt="Featured Xamarin Planet Community Blog" title="Featured Xamarin Planet Community Blog" /></a></p>

     <p> 
      <iframe src="http://githubbadge.appspot.com/badge/Redth?a=0" style="border: 0;height: 108px;width: 200px;overflow: hidden;" frameBorder=0></iframe>     
     </p>
     
     <p>
      <a href="http://ca.linkedin.com/pub/jonathan-dick/3/a60/2b5"><img src="http://www.linkedin.com/img/webpromo/btn_viewmy_160x33.png" width="160" height="33" border="0" alt="View Jonathan Dick's profile on LinkedIn"></a>
      </p>


      <table cellpadding="0" cellspacing="0">
        <tr>
          <td>
            <a href="http://xamarin.com/mvp" target="_blank" style="border-style: none;"><img src="/images/Site/Xamarin-MVP-Badge.png" alt="Xamarin Most Valuable Professional" /></a>
          </td>
          <td>
            <a href="http://xamarin.com/consulting-partners" target="_blank" style="border-style: none;"><img src="/images/Site/Xamarin-Certified-Developer.png" alt="Xamarin Certified Developer" /></a>
          </td>         
        </tr>
      </table>
      <br />
      

      <a class="twitter-timeline" data-dnt=true href="https://twitter.com/redth" data-widget-id="253917988271562752">Tweets by @redth</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/Xamarin-Google-Play-Services-Improvements">Improvements coming to Xamarin Google Play Services</a>
      </li>
    
      <li class="post">
        <a href="/Xamarin-Studio-Launcher-v3">New and Improved Xamarin Studio Launcher</a>
      </li>
    
      <li class="post">
        <a href="/smarter-android-support-v4-v13-packages">Smarter Xamarin Android Support v4 / v13 Packages</a>
      </li>
    
      <li class="post">
        <a href="/unifying-google-play-services">Unifying Google Play Services</a>
      </li>
    
      <li class="post">
        <a href="/android-keystore-signatures-md5-sha1">Finding your Android app's MD5 or SHA1 Signature from your keystore</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Jon -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'redth';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://redth.info/Xamarin-Google-Play-Services-Improvements';
        var disqus_url = 'http://redth.info/Xamarin-Google-Play-Services-Improvements';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
